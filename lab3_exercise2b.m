clc;
clear;
close all;
%lab3_ex2a(5,100,1,0);
%lab3_ex2a(5,100,2,0);
%lab3_ex2b(5,1000,50,3,0.7);
lab3_ex2b(15,1000,100,2,0.9);
function[E,A] = lab3_ex2b(P,N,M,k,e)

h = 2*pi/N;
t = 0:h:P*N*h;

x = zeros(2,P*N+1);

y = zeros(2,P*N+1);

x(1,1) = 1-e;
x(2,1) = 0;
y(1,1) = 0;
y(2,1) = ((1+e)/(1-e))^0.5;

E = zeros(1, P*N+1);
A = zeros(1, P*N+1);

r1 = sqrt(x(1,1)^2 + y(1,1)^2);
E(1) = 0.5 * (x(2,1)^2 + y(2,1)^2) - 1 / r1;
A(1) = x(1,1) * y(2,1) - y(1,1) * x(2,1);


if k == 1
    for n = 1:P*N
         x(:,n+1) = x(:,n);
        y(:,n+1) = y(:,n);
        for j = 1:M
            x(:,n+1) = x(:,n) + 0.5*h*[x(2,n+1); -x(1,n+1)/(x(1,n+1)^2 + y(1,n)^2)^1.5] + 0.5*h*[x(2,n);-x(1,n)/(x(1,n)^2 + y(1,n)^2)^1.5];
            y(:,n+1) = y(:,n) + 0.5*h*[y(2,n+1); -y(1,n+1)/(x(1,n)^2 + y(1,n+1)^2)^1.5] + 0.5*h*[y(2,n);-y(1,n)/(x(1,n)^2 + y(1,n)^2)^1.5];

        end    
    end    

elseif k==2
    for n = 1:1
         x(:,n+1) = x(:,n);
        y(:,n+1) = y(:,n);
        for j = 1:M
            x(:,n+1) = x(:,n) + 0.5*h*[x(2,n+1); -x(1,n+1)/(x(1,n+1)^2 + y(1,n)^2)^1.5] + 0.5*h*[x(2,n);-x(1,n)/(x(1,n)^2 + y(1,n)^2)^1.5];
            y(:,n+1) = y(:,n) + 0.5*h*[y(2,n+1); -y(1,n+1)/(x(1,n)^2 + y(1,n+1)^2)^1.5] + 0.5*h*[y(2,n);-y(1,n)/(x(1,n)^2 + y(1,n)^2)^1.5];

        end    
    end
    for n = 2:P*N
         x(:,n+1) = x(:,n);
        y(:,n+1) = y(:,n);
        for j = 1:M
            x(:,n+1) = x(:,n) + 5*h*[x(2,n+1); -x(1,n+1)/(x(1,n+1)^2 + y(1,n)^2)^1.5]/12 + 8*h*[x(2,n);-x(1,n)/(x(1,n)^2 + y(1,n)^2)^1.5]/12 - h*[x(2,n-1);-x(1,n-1)/(x(1,n-1)^2 + y(1,n-1)^2)^1.5]/12;
            y(:,n+1) = y(:,n) + 5*h*[y(2,n+1); -y(1,n+1)/(x(1,n)^2 + y(1,n+1)^2)^1.5]/12 + 8*h*[y(2,n);-y(1,n)/(x(1,n)^2 + y(1,n)^2)^1.5]/12 - h*[y(2,n-1);-y(1,n-1)/(x(1,n-1)^2 + y(1,n-1)^2)^1.5]/12;
        end    
    end   

else
    
    for n = 1:1
         x(:,n+1) = x(:,n);
        y(:,n+1) = y(:,n);
        for j = 1:M
            x(:,n+1) = x(:,n) + 0.5*h*[x(2,n+1); -x(1,n+1)/(x(1,n+1)^2 + y(1,n)^2)^1.5] + 0.5*h*[x(2,n);-x(1,n)/(x(1,n)^2 + y(1,n)^2)^1.5];
            y(:,n+1) = y(:,n) + 0.5*h*[y(2,n+1); -y(1,n+1)/(x(1,n)^2 + y(1,n+1)^2)^1.5] + 0.5*h*[y(2,n);-y(1,n)/(x(1,n)^2 + y(1,n)^2)^1.5];

        end    
    end
    for n = 2:2
         x(:,n+1) = x(:,n);
        y(:,n+1) = y(:,n);
        for j = 1:M
            x(:,n+1) = x(:,n) + 5*h*[x(2,n+1); -x(1,n+1)/(x(1,n+1)^2 + y(1,n)^2)^1.5]/12 + 8*h*[x(2,n);-x(1,n)/(x(1,n)^2 + y(1,n)^2)^1.5]/12 - h*[x(2,n-1);-x(1,n-1)/(x(1,n-1)^2 + y(1,n-1)^2)^1.5]/12;
            y(:,n+1) = y(:,n) + 5*h*[y(2,n+1); -y(1,n+1)/(x(1,n)^2 + y(1,n+1)^2)^1.5]/12 + 8*h*[y(2,n);-y(1,n)/(x(1,n)^2 + y(1,n)^2)^1.5]/12 - h*[y(2,n-1);-y(1,n-1)/(x(1,n-1)^2 + y(1,n-1)^2)^1.5]/12;
        end    
    end

    for n = 3:P*N
         x(:,n+1) = x(:,n);
        y(:,n+1) = y(:,n);
        for j = 1:M
            x(:,n+1) = x(:,n) + 9*h*[x(2,n+1); -x(1,n+1)/(x(1,n+1)^2 + y(1,n)^2)^1.5]/24 + 19*h*[x(2,n);-x(1,n)/(x(1,n)^2 + y(1,n)^2)^1.5]/24 - 5*h*[x(2,n-1);-x(1,n-1)/(x(1,n-1)^2 + y(1,n-1)^2)^1.5]/24 + h*[x(2,n-2);-x(1,n-2)/(x(1,n-2)^2 + y(1,n-2)^2)^1.5]/24;
            y(:,n+1) = y(:,n) + 9*h*[y(2,n+1); -y(1,n+1)/(x(1,n)^2 + y(1,n+1)^2)^1.5]/24 + 19*h*[y(2,n);-y(1,n)/(x(1,n)^2 + y(1,n)^2)^1.5]/24 - 5*h*[y(2,n-1);-y(1,n-1)/(x(1,n-1)^2 + y(1,n-1)^2)^1.5]/24 + h*[y(2,n-2);-y(1,n-2)/(x(1,n-2)^2 + y(1,n-2)^2)^1.5]/24;
        end    
    end


end    
subplot(3,1,1);
plot(x(1,:),y(1,:));
subplot(3,1,2);
plot (x(1,:),t);
subplot(3,1,3);
plot (y(1,:),t);

end